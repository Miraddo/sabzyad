{{ define "main" }}
{{/* Build a language-aware collection of courses (sections + leaf pages), excluding lessons */}}
{{ $prefix := .Site.LanguagePrefix }}
{{ $coursesPath := printf "%s/courses" $prefix }}
{{ $coursesSection := $.Site.GetPage $coursesPath }}
{{ if not $coursesSection }}
  {{ $coursesSection = $.Site.GetPage "/courses" }}
{{ end }}
{{ $pages := cond $coursesSection $coursesSection.RegularPages (slice) }}
{{ $children := cond $coursesSection $coursesSection.Sections (slice) }}
{{ $sectionLinks := slice }}
{{ range $children }}
  {{ $sectionLinks = $sectionLinks | append .RelPermalink }}
{{ end }}
{{ $pagesFiltered := slice }}
{{ range $pages }}
  {{ if not (in $sectionLinks .RelPermalink) }}
    {{ $pagesFiltered = $pagesFiltered | append . }}
  {{ end }}
{{ end }}
{{ $allCourses := union $pagesFiltered $children }}
<!-- Hero Section (Enhanced) -->
<section class="hero-section">
  <div class="hero-bg-shapes" aria-hidden="true">
    <span class="shape s1"></span>
    <span class="shape s2"></span>
    <span class="shape s3"></span>
  </div>
  <div class="container">
    <div class="hero-content">
      <div class="hero-badge">
        <span class="badge-icon">🚀</span>
        <span>رشد مهارت واقعی — نه حفظ کردن</span>
      </div>

      <h1 class="hero-title">
        <span class="hero-title-top">یادگیری عمیق و تدریجی</span>
        <span class="hero-title-accent"> برای ساختن مهارت پایدار</span>
      </h1>
      <p class="hero-subtitle">
        سبزیاد مجموعه‌ای آزاد از مسیرهای یادگیری، تمرین‌های مرحله‌ای و منابع قابل اعتماد است؛
        تمرکز روی فهم، تمرین و تکرار — بدون حواس‌پرتی اضافه.
      </p>

      <form id="heroSearchForm" class="hero-search" role="search" aria-label="جستجوی دوره یا موضوع">
        <div class="hero-search-inner">
          <input id="heroSearchInput" type="search" placeholder="چی می‌خوای یاد بگیری؟ مثلا: پایتون، گیت، الگوریتم..." aria-label="جستجو" autocomplete="off" />
          <button type="submit" class="hero-search-btn" aria-label="جستجو">جستجو</button>
        </div>
        <div class="hero-pill-list" aria-hidden="true">
          <button type="button" class="pill" data-q="python">پایتون</button>
          <button type="button" class="pill" data-q="git">گیت</button>
          <button type="button" class="pill" data-q="linux">لینوکس</button>
          <button type="button" class="pill" data-q="sql">SQL</button>
          <button type="button" class="pill" data-q="docker">Docker</button>
        </div>
      </form>

      <div class="hero-actions">
        <a href="/fa/courses/" class="btn btn-primary btn-large">
          <span>شروع سریع</span>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M5 12h14M12 5l7 7-7 7"></path>
          </svg>
        </a>
        <a href="/fa/about/" class="btn btn-outline btn-large">
          <span>چطور کار می‌کنیم؟</span>
        </a>
      </div>

      <div class="hero-benefits">
        <div class="benefit-item">🧭 مسیرهای شفاف</div>
        <div class="benefit-item">🧪 تمرین عملی</div>
        <div class="benefit-item">🔁 به‌روزرسانی مداوم</div>
        <div class="benefit-item">💬 اشتراک تجربه</div>
      </div>

      <div class="hero-stats">
        <div class="stat-item">
          <div class="stat-number">{{ len $allCourses }}+</div>
          <div class="stat-label">دوره / مسیر</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">100%</div>
          <div class="stat-label">رایگان</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">∞</div>
          <div class="stat-label">دسترسی دائم</div>
        </div>
      </div>
    </div>
  </div>
  <script>
  document.addEventListener('DOMContentLoaded', ()=> {
    const form = document.getElementById('heroSearchForm');
    const input = document.getElementById('heroSearchInput');
    const pills = form?.querySelectorAll('.pill');
    function triggerSearch(q){
      if(!q) return;
      const openBtn = document.querySelector('[data-search-open]');
      if(openBtn){
        openBtn.dispatchEvent(new Event('click', {bubbles:true}));
        setTimeout(()=>{
          const overlayInput = document.getElementById('siteSearchInput');
          if(overlayInput){ overlayInput.value = q; overlayInput.dispatchEvent(new Event('input')); }
        }, 140);
      }
    }
    form?.addEventListener('submit', e=>{ e.preventDefault(); triggerSearch(input.value.trim()); });
    pills?.forEach(p=> p.addEventListener('click', ()=>{ const q = p.getAttribute('data-q'); input.value = q; triggerSearch(q); }));
  });
  </script>
</section>

<!-- Features Section -->
<section class="features-section">
  <div class="container">
    <header class="features-header">
      <span class="features-badge">چرا سبزیاد؟</span>
      <h2 class="features-title">هر چیزی که برای یادگیری عمیق نیاز داری 🌱</h2>
      <p class="features-subtitle">از ویدیو و تمرین تا مسیر یادگیری، همه رایگان و در یک جا. تمرکز روی تجربه واقعی و رشد مرحله‌ای.</p>
    </header>

    <div class="features-grid enhanced">
      <div class="feature-card fx-rise">
        <div class="feature-head">
          <div class="feature-icon">🏃‍♂️</div>
          <span class="feature-tag">Practice First</span>
        </div>
        <h3 class="feature-title">یادگیری با تمرین عملی</h3>
        <p class="feature-text">هر درس با یک تمرین یا مثال کاربردی همراهه تا سریع‌تر به مهارت تبدیل بشه.</p>
        <ul class="feature-points">
          <li>تمرین‌های مرحله‌ای</li>
          <li>حل نمونه + توضیح</li>
          <li>سناریوهای واقعی</li>
        </ul>
      </div>

      <div class="feature-card fx-rise">
        <div class="feature-head">
          <div class="feature-icon">🧭</div>
          <span class="feature-tag alt">Path</span>
        </div>
        <h3 class="feature-title">مسیرهای یادگیری مرحله‌ای</h3>
        <p class="feature-text">به جای گم شدن در منابع پراکنده، نقشه راه شفاف داری که قدم به قدم تو رو جلو می‌بره.</p>
        <ul class="feature-points">
          <li>نقشه راه واضح</li>
          <li>پیش‌نیازهای مشخص</li>
          <li>ارتقا تدریجی مهارت</li>
        </ul>
      </div>

      <div class="feature-card fx-rise">
        <div class="feature-head">
          <div class="feature-icon">🔄</div>
          <span class="feature-tag accent">Alive</span>
        </div>
        <h3 class="feature-title">به‌روزرسانی پیوسته</h3>
        <p class="feature-text">مطالب ثابت نمی‌مونن؛ با تغییر ابزارها و نسخه‌ها، محتوای جدید اضافه می‌شه.</p>
        <ul class="feature-points">
          <li>بازبینی منظم</li>
          <li>افزودن مثال‌های تازه</li>
          <li>هماهنگ با نسخه‌های جدید</li>
        </ul>
      </div>

      <div class="feature-card fx-rise">
        <div class="feature-head">
          <div class="feature-icon">💬</div>
          <span class="feature-tag support">Support</span>
        </div>
        <h3 class="feature-title">جامعه و همراهی</h3>
        <p class="feature-text">قرار نیست تنها باشی؛ مسیر یادگیری با بازخورد، پیشنهاد و تبادل تجربه کامل می‌شه.</p>
        <ul class="feature-points">
          <li>پیشنهاد منابع تکمیلی</li>
          <li>گفتگو پیرامون چالش‌ها</li>
          <li>اشتراک تجربه سایر یادگیرنده‌ها</li>
        </ul>
      </div>
    </div>
  </div>
</section>

<!-- Featured Courses Section -->
<section class="courses-section">
  <div class="container">
    <h2 class="section-title">دوره‌های رایگان آموزشی 🎓</h2>
    <p class="section-subtitle">همه دوره‌ها کاملاً رایگان و در دسترس همگان</p>
    
    <div class="courses-grid">
      {{ range $allCourses }}
        {{ $isLesson := or (eq .Type "lessons") (eq (lower .Section) "lessons") (eq .Params.type "lessons") }}
        {{ if not $isLesson }}
        <div class="course-card">
          <div class="course-image">
            {{ if .Params.image }}
              <img src="{{ .Params.image }}" alt="{{ .Title }}" loading="lazy">
            {{ else }}
              <div class="image-placeholder">
                <div class="placeholder-icon">📚</div>
              </div>
            {{ end }}
            
            {{ if .Params.difficulty }}
              <div class="course-level">{{ .Params.difficulty }}</div>
            {{ end }}
          </div>
          
          <div class="course-content">
            <h3 class="course-title">
              <a href="{{ .Permalink }}">{{ .Title }}</a>
            </h3>
            
            {{ if .Params.description }}
              <p class="course-description">{{ .Params.description }}</p>
            {{ else }}
              <p class="course-description">{{ .Summary | truncate 120 }}</p>
            {{ end }}
          </div>
          
          <div class="course-footer">
            <a href="{{ .Permalink }}" class="course-btn">
              <span class="btn-text">مشاهده دوره</span>
              <svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 18l6-6-6-6"/>
              </svg>
            </a>
          </div>
        </div>
        {{ end }}
      {{ end }}
    </div>
    
    <div class="section-cta">
      <a href="/fa/courses/" class="btn btn-primary">مشاهده همه دوره‌ها</a>
    </div>
  </div>
</section>

<!-- Blog Section -->
<section class="blog-section">
  <div class="container">
    <h2 class="section-title">جدیدترین مقالات آموزشی 🌿</h2>
    <div class="blog-grid">
      {{ range where .Site.RegularPages "Type" "posts" | first 3 }}
        <article class="blog-card">
          <div class="blog-image">
            {{ if .Params.image }}
              <img src="{{ .Params.image }}" alt="{{ .Title }}" loading="lazy">
            {{ end }}
          </div>
          
          <div class="blog-content">
            <h3 class="blog-title">
              <a href="{{ .Permalink }}">{{ .Title }}</a>
            </h3>
            
            <p class="blog-excerpt">{{ .Summary | truncate 100 }}</p>
            
            <div class="blog-meta">
              <time datetime="{{ .Date.Format "2006-01-02" }}" data-date="{{ .Date.Format "2006-01-02" }}">
                {{ .Date.Format "2 January 2006" }}
              </time>
            </div>
            
            <a href="{{ .Permalink }}" class="read-more">بیشتر بخوانید ...</a>
          </div>
        </article>
      {{ end }}
    </div>
  </div>
</section>
{{ end }}