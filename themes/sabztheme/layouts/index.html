{{ define "main" }}
{{/* Build a language-aware collection of courses (sections + leaf pages), excluding lessons */}}
{{ $prefix := .Site.LanguagePrefix }}
{{ $coursesPath := printf "%s/courses" $prefix }}
{{ $coursesSection := $.Site.GetPage $coursesPath }}
{{ if not $coursesSection }}
  {{ $coursesSection = $.Site.GetPage "/courses" }}
{{ end }}
{{ $pages := cond $coursesSection $coursesSection.RegularPages (slice) }}
{{ $children := cond $coursesSection $coursesSection.Sections (slice) }}
{{ $sectionLinks := slice }}
{{ range $children }}
  {{ $sectionLinks = $sectionLinks | append .RelPermalink }}
{{ end }}
{{ $pagesFiltered := slice }}
{{ range $pages }}
  {{ if not (in $sectionLinks .RelPermalink) }}
    {{ $pagesFiltered = $pagesFiltered | append . }}
  {{ end }}
{{ end }}
{{ $allCourses := union $pagesFiltered $children }}
<!-- Hero Section (Enhanced) -->
<section class="hero-section">
  <div class="hero-bg-shapes" aria-hidden="true">
    <span class="shape s1"></span>
    <span class="shape s2"></span>
    <span class="shape s3"></span>
  </div>
  <div class="container">
    <div class="hero-content">
      <div class="hero-badge">
        <span class="badge-icon">๐</span>
        <span>ุฑุดุฏ ููุงุฑุช ูุงูุน โ ูู ุญูุธ ฺฉุฑุฏู</span>
      </div>

      <h1 class="hero-title">
        <span class="hero-title-top">ุงุฏฺฏุฑ ุนูู ู ุชุฏุฑุฌ</span>
        <span class="hero-title-accent"> ุจุฑุง ุณุงุฎุชู ููุงุฑุช ูพุงุฏุงุฑ</span>
      </h1>
      <p class="hero-subtitle">
        ุณุจุฒุงุฏ ูุฌููุนูโุง ุขุฒุงุฏ ุงุฒ ูุณุฑูุง ุงุฏฺฏุฑุ ุชูุฑูโูุง ูุฑุญููโุง ู ููุงุจุน ูุงุจู ุงุนุชูุงุฏ ุงุณุชุ
        ุชูุฑฺฉุฒ ุฑู ูููุ ุชูุฑู ู ุชฺฉุฑุงุฑ โ ุจุฏูู ุญูุงุณโูพุฑุช ุงุถุงูู.
      </p>

      <form id="heroSearchForm" class="hero-search" role="search" aria-label="ุฌุณุชุฌู ุฏูุฑู ุง ููุถูุน">
        <div class="hero-search-inner">
          <input id="heroSearchInput" type="search" placeholder="ฺ ูโุฎูุง ุงุฏ ุจฺฏุฑุ ูุซูุง: ูพุงุชููุ ฺฏุชุ ุงูฺฏูุฑุชู..." aria-label="ุฌุณุชุฌู" autocomplete="off" />
          <button type="submit" class="hero-search-btn" aria-label="ุฌุณุชุฌู">ุฌุณุชุฌู</button>
        </div>
        <div class="hero-pill-list" aria-hidden="true">
          <button type="button" class="pill" data-q="python">ูพุงุชูู</button>
          <button type="button" class="pill" data-q="git">ฺฏุช</button>
          <button type="button" class="pill" data-q="linux">ูููฺฉุณ</button>
          <button type="button" class="pill" data-q="sql">SQL</button>
          <button type="button" class="pill" data-q="docker">Docker</button>
        </div>
      </form>

      <div class="hero-actions">
        <a href="/fa/courses/" class="btn btn-primary btn-large">
          <span>ุดุฑูุน ุณุฑุน</span>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M5 12h14M12 5l7 7-7 7"></path>
          </svg>
        </a>
        <a href="/fa/about/" class="btn btn-outline btn-large">
          <span>ฺุทูุฑ ฺฉุงุฑ ูโฺฉููุ</span>
        </a>
      </div>

      <div class="hero-benefits">
        <div class="benefit-item">๐งญ ูุณุฑูุง ุดูุงู</div>
        <div class="benefit-item">๐งช ุชูุฑู ุนูู</div>
        <div class="benefit-item">๐ ุจูโุฑูุฒุฑุณุงู ูุฏุงูู</div>
        <div class="benefit-item">๐ฌ ุงุดุชุฑุงฺฉ ุชุฌุฑุจู</div>
      </div>

      <div class="hero-stats">
        <div class="stat-item">
          <div class="stat-number">{{ len $allCourses }}+</div>
          <div class="stat-label">ุฏูุฑู / ูุณุฑ</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">100%</div>
          <div class="stat-label">ุฑุงฺฏุงู</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">โ</div>
          <div class="stat-label">ุฏุณุชุฑุณ ุฏุงุฆู</div>
        </div>
      </div>
    </div>
  </div>
  <script>
  document.addEventListener('DOMContentLoaded', ()=> {
    const form = document.getElementById('heroSearchForm');
    const input = document.getElementById('heroSearchInput');
    const pills = form?.querySelectorAll('.pill');
    function triggerSearch(q){
      if(!q) return;
      const openBtn = document.querySelector('[data-search-open]');
      if(openBtn){
        openBtn.dispatchEvent(new Event('click', {bubbles:true}));
        setTimeout(()=>{
          const overlayInput = document.getElementById('siteSearchInput');
          if(overlayInput){ overlayInput.value = q; overlayInput.dispatchEvent(new Event('input')); }
        }, 140);
      }
    }
    form?.addEventListener('submit', e=>{ e.preventDefault(); triggerSearch(input.value.trim()); });
    pills?.forEach(p=> p.addEventListener('click', ()=>{ const q = p.getAttribute('data-q'); input.value = q; triggerSearch(q); }));
  });
  </script>
</section>

<!-- Features Section -->
<section class="features-section">
  <div class="container">
    <header class="features-header">
      <span class="features-badge">ฺุฑุง ุณุจุฒุงุฏุ</span>
      <h2 class="features-title">ูุฑ ฺุฒ ฺฉู ุจุฑุง ุงุฏฺฏุฑ ุนูู ูุงุฒ ุฏุงุฑ ๐ฑ</h2>
      <p class="features-subtitle">ุงุฒ ูุฏู ู ุชูุฑู ุชุง ูุณุฑ ุงุฏฺฏุฑุ ููู ุฑุงฺฏุงู ู ุฏุฑ ฺฉ ุฌุง. ุชูุฑฺฉุฒ ุฑู ุชุฌุฑุจู ูุงูุน ู ุฑุดุฏ ูุฑุญููโุง.</p>
    </header>

    <div class="features-grid enhanced">
      <div class="feature-card fx-rise">
        <div class="feature-head">
          <div class="feature-icon">๐โโ๏ธ</div>
          <span class="feature-tag">Practice First</span>
        </div>
        <h3 class="feature-title">ุงุฏฺฏุฑ ุจุง ุชูุฑู ุนูู</h3>
        <p class="feature-text">ูุฑ ุฏุฑุณ ุจุง ฺฉ ุชูุฑู ุง ูุซุงู ฺฉุงุฑุจุฑุฏ ููุฑุงูู ุชุง ุณุฑุนโุชุฑ ุจู ููุงุฑุช ุชุจุฏู ุจุดู.</p>
        <ul class="feature-points">
          <li>ุชูุฑูโูุง ูุฑุญููโุง</li>
          <li>ุญู ููููู + ุชูุถุญ</li>
          <li>ุณูุงุฑููุง ูุงูุน</li>
        </ul>
      </div>

      <div class="feature-card fx-rise">
        <div class="feature-head">
          <div class="feature-icon">๐งญ</div>
          <span class="feature-tag alt">Path</span>
        </div>
        <h3 class="feature-title">ูุณุฑูุง ุงุฏฺฏุฑ ูุฑุญููโุง</h3>
        <p class="feature-text">ุจู ุฌุง ฺฏู ุดุฏู ุฏุฑ ููุงุจุน ูพุฑุงฺฉูุฏูุ ููุดู ุฑุงู ุดูุงู ุฏุงุฑ ฺฉู ูุฏู ุจู ูุฏู ุชู ุฑู ุฌูู ูโุจุฑู.</p>
        <ul class="feature-points">
          <li>ููุดู ุฑุงู ูุงุถุญ</li>
          <li>ูพุดโูุงุฒูุง ูุดุฎุต</li>
          <li>ุงุฑุชูุง ุชุฏุฑุฌ ููุงุฑุช</li>
        </ul>
      </div>

      <div class="feature-card fx-rise">
        <div class="feature-head">
          <div class="feature-icon">๐</div>
          <span class="feature-tag accent">Alive</span>
        </div>
        <h3 class="feature-title">ุจูโุฑูุฒุฑุณุงู ูพูุณุชู</h3>
        <p class="feature-text">ูุทุงูุจ ุซุงุจุช ููโููููุ ุจุง ุชุบุฑ ุงุจุฒุงุฑูุง ู ูุณุฎูโูุงุ ูุญุชูุง ุฌุฏุฏ ุงุถุงูู ูโุดู.</p>
        <ul class="feature-points">
          <li>ุจุงุฒุจู ููุธู</li>
          <li>ุงูุฒูุฏู ูุซุงูโูุง ุชุงุฒู</li>
          <li>ููุงููฺฏ ุจุง ูุณุฎูโูุง ุฌุฏุฏ</li>
        </ul>
      </div>

      <div class="feature-card fx-rise">
        <div class="feature-head">
          <div class="feature-icon">๐ฌ</div>
          <span class="feature-tag support">Support</span>
        </div>
        <h3 class="feature-title">ุฌุงูุนู ู ููุฑุงู</h3>
        <p class="feature-text">ูุฑุงุฑ ูุณุช ุชููุง ุจุงุดุ ูุณุฑ ุงุฏฺฏุฑ ุจุง ุจุงุฒุฎูุฑุฏุ ูพุดููุงุฏ ู ุชุจุงุฏู ุชุฌุฑุจู ฺฉุงูู ูโุดู.</p>
        <ul class="feature-points">
          <li>ูพุดููุงุฏ ููุงุจุน ุชฺฉูู</li>
          <li>ฺฏูุชฺฏู ูพุฑุงููู ฺุงูุดโูุง</li>
          <li>ุงุดุชุฑุงฺฉ ุชุฌุฑุจู ุณุงุฑ ุงุฏฺฏุฑูุฏูโูุง</li>
        </ul>
      </div>
    </div>
  </div>
</section>

<!-- Featured Courses Section -->
<section class="courses-section">
  <div class="container">
    <h2 class="section-title">ุฏูุฑูโูุง ุฑุงฺฏุงู ุขููุฒุด ๐</h2>
    <p class="section-subtitle">ููู ุฏูุฑูโูุง ฺฉุงููุงู ุฑุงฺฏุงู ู ุฏุฑ ุฏุณุชุฑุณ ููฺฏุงู</p>
    
    <div class="courses-grid">
      {{ range $allCourses }}
        {{ $isLesson := or (eq .Type "lessons") (eq (lower .Section) "lessons") (eq .Params.type "lessons") }}
        {{ if not $isLesson }}
        <div class="course-card">
          <div class="course-image">
            {{ if .Params.image }}
              <img src="{{ .Params.image }}" alt="{{ .Title }}" loading="lazy">
            {{ else }}
              <div class="image-placeholder">
                <div class="placeholder-icon">๐</div>
              </div>
            {{ end }}
            
            {{ if .Params.difficulty }}
              <div class="course-level">{{ .Params.difficulty }}</div>
            {{ end }}
          </div>
          
          <div class="course-content">
            <h3 class="course-title">
              <a href="{{ .Permalink }}">{{ .Title }}</a>
            </h3>
            
            {{ if .Params.description }}
              <p class="course-description">{{ .Params.description }}</p>
            {{ else }}
              <p class="course-description">{{ .Summary | truncate 120 }}</p>
            {{ end }}
          </div>
          
          <div class="course-footer">
            <a href="{{ .Permalink }}" class="course-btn">
              <span class="btn-text">ูุดุงูุฏู ุฏูุฑู</span>
              <svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 18l6-6-6-6"/>
              </svg>
            </a>
          </div>
        </div>
        {{ end }}
      {{ end }}
    </div>
    
    <div class="section-cta">
      <a href="/fa/courses/" class="btn btn-primary">ูุดุงูุฏู ููู ุฏูุฑูโูุง</a>
    </div>
  </div>
</section>

<!-- Blog Section -->
<section class="blog-section">
  <div class="container">
    <h2 class="section-title">ุฌุฏุฏุชุฑู ููุงูุงุช ุขููุฒุด ๐ฟ</h2>
    <div class="blog-grid">
      {{ range where .Site.RegularPages "Type" "posts" | first 3 }}
        <article class="blog-card">
          <div class="blog-image">
            {{ if .Params.image }}
              <img src="{{ .Params.image }}" alt="{{ .Title }}" loading="lazy">
            {{ end }}
          </div>
          
          <div class="blog-content">
            <h3 class="blog-title">
              <a href="{{ .Permalink }}">{{ .Title }}</a>
            </h3>
            
            <p class="blog-excerpt">{{ .Summary | truncate 100 }}</p>
            
            <div class="blog-meta">
              <time datetime="{{ .Date.Format "2006-01-02" }}" data-date="{{ .Date.Format "2006-01-02" }}">
                {{ .Date.Format "2 January 2006" }}
              </time>
            </div>
            
            <a href="{{ .Permalink }}" class="read-more">ุจุดุชุฑ ุจุฎูุงูุฏ ...</a>
          </div>
        </article>
      {{ end }}
    </div>
  </div>
</section>
{{ end }}