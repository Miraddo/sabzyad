{{ define "main" }}
{{/* Build a language-aware collection of courses (sections + leaf pages), excluding lessons */}}
{{ $prefix := .Site.LanguagePrefix }}
{{ $coursesPath := printf "%s/courses" $prefix }}
{{ $coursesSection := $.Site.GetPage $coursesPath }}
{{ if not $coursesSection }}
  {{ $coursesSection = $.Site.GetPage "/courses" }}
{{ end }}
{{ $pages := cond $coursesSection $coursesSection.RegularPages (slice) }}
{{ $children := cond $coursesSection $coursesSection.Sections (slice) }}
{{ $sectionLinks := slice }}
{{ range $children }}
  {{ $sectionLinks = $sectionLinks | append .RelPermalink }}
{{ end }}
{{ $pagesFiltered := slice }}
{{ range $pages }}
  {{ if not (in $sectionLinks .RelPermalink) }}
    {{ $pagesFiltered = $pagesFiltered | append . }}
  {{ end }}
{{ end }}
{{ $allCourses := union $pagesFiltered $children }}
<!-- Hero Section (Enhanced) -->
<section class="hero-section">
  <div class="hero-bg-shapes" aria-hidden="true">
    <span class="shape s1"></span>
    <span class="shape s2"></span>
    <span class="shape s3"></span>
  </div>
  <div class="container">
    <div class="hero-content">
      <div class="hero-badge">
        <span class="badge-icon">🚀</span>
        <span>{{ i18n "home.badge" }}</span>
      </div>

      <h1 class="hero-title">
        <span class="hero-title-top">{{ i18n "home.title_top" }}</span>
        <span class="hero-title-accent"> {{ i18n "home.title_accent" }}</span>
      </h1>
      <p class="hero-subtitle">
        {{ i18n "home.subtitle" }}
      </p>

    <form id="heroSearchForm" class="hero-search" role="search" aria-label="{{ i18n "home.search.aria" }}">
        <div class="hero-search-inner">
      <input id="heroSearchInput" type="search" placeholder="{{ i18n "home.search.placeholder" }}" aria-label="{{ i18n "search.title" }}" autocomplete="off" />
      <button type="submit" class="hero-search-btn" aria-label="{{ i18n "search.title" }}">{{ i18n "home.search.button" }}</button>
        </div>
        <div class="hero-pill-list" aria-hidden="true">
      <button type="button" class="pill" data-q="python">{{ i18n "home.search.pill.python" }}</button>
      <button type="button" class="pill" data-q="git">{{ i18n "home.search.pill.git" }}</button>
      <button type="button" class="pill" data-q="linux">{{ i18n "home.search.pill.linux" }}</button>
      <button type="button" class="pill" data-q="sql">{{ i18n "home.search.pill.sql" }}</button>
      <button type="button" class="pill" data-q="docker">{{ i18n "home.search.pill.docker" }}</button>
        </div>
      </form>

      <div class="hero-actions">
  <a href="{{ "/courses/" | relLangURL }}" class="btn btn-primary btn-large">
          <span>{{ i18n "home.actions.start_quick" }}</span>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M5 12h14M12 5l7 7-7 7"></path>
          </svg>
        </a>
  <a href="{{ "/about/" | relLangURL }}" class="btn btn-outline btn-large">
          <span>{{ i18n "home.actions.how_we_work" }}</span>
        </a>
      </div>

      <div class="hero-benefits">
        <div class="benefit-item">🧭 {{ i18n "home.benefits.paths" }}</div>
        <div class="benefit-item">🧪 {{ i18n "home.benefits.practice" }}</div>
        <div class="benefit-item">🔁 {{ i18n "home.benefits.updates" }}</div>
        <div class="benefit-item">💬 {{ i18n "home.benefits.community" }}</div>
      </div>

    <div class="hero-stats">
        <div class="stat-item">
          <div class="stat-number">{{ len $allCourses }}+</div>
      <div class="stat-label">{{ i18n "home.stats.courses" }}</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">100%</div>
      <div class="stat-label">{{ i18n "home.stats.free" }}</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">∞</div>
      <div class="stat-label">{{ i18n "home.stats.access" }}</div>
        </div>
      </div>
    </div>
  </div>
  <script>
  document.addEventListener('DOMContentLoaded', ()=> {
    const form = document.getElementById('heroSearchForm');
    const input = document.getElementById('heroSearchInput');
    const pills = form?.querySelectorAll('.pill');
    function triggerSearch(q){
      if(!q) return;
      const openBtn = document.querySelector('[data-search-open]');
      if(openBtn){
        openBtn.dispatchEvent(new Event('click', {bubbles:true}));
        setTimeout(()=>{
          const overlayInput = document.getElementById('siteSearchInput');
          if(overlayInput){ overlayInput.value = q; overlayInput.dispatchEvent(new Event('input')); }
        }, 140);
      }
    }
    form?.addEventListener('submit', e=>{ e.preventDefault(); triggerSearch(input.value.trim()); });
    pills?.forEach(p=> p.addEventListener('click', ()=>{ const q = p.getAttribute('data-q'); input.value = q; triggerSearch(q); }));
  });
  </script>
</section>

<!-- Features Section -->
<section class="features-section">
  <div class="container">
    <header class="features-header">
  <span class="features-badge">{{ i18n "home.features.badge" }}</span>
  <h2 class="features-title">{{ i18n "home.features.title" }}</h2>
  <p class="features-subtitle">{{ i18n "home.features.subtitle" }}</p>
    </header>

    <div class="features-grid enhanced">
      <div class="feature-card fx-rise">
        <div class="feature-head">
          <div class="feature-icon">🏃‍♂️</div>
          <span class="feature-tag">{{ i18n "home.features.cards.practice.tag" }}</span>
        </div>
        <h3 class="feature-title">{{ i18n "home.features.cards.practice.title" }}</h3>
        <p class="feature-text">{{ i18n "home.features.cards.practice.text" }}</p>
        <ul class="feature-points">
          <li>{{ i18n "home.features.cards.practice.point1" }}</li>
          <li>{{ i18n "home.features.cards.practice.point2" }}</li>
          <li>{{ i18n "home.features.cards.practice.point3" }}</li>
        </ul>
      </div>

      <div class="feature-card fx-rise">
        <div class="feature-head">
          <div class="feature-icon">🧭</div>
          <span class="feature-tag alt">{{ i18n "home.features.cards.path.tag" }}</span>
        </div>
        <h3 class="feature-title">{{ i18n "home.features.cards.path.title" }}</h3>
        <p class="feature-text">{{ i18n "home.features.cards.path.text" }}</p>
        <ul class="feature-points">
          <li>{{ i18n "home.features.cards.path.point1" }}</li>
          <li>{{ i18n "home.features.cards.path.point2" }}</li>
          <li>{{ i18n "home.features.cards.path.point3" }}</li>
        </ul>
      </div>

      <div class="feature-card fx-rise">
        <div class="feature-head">
          <div class="feature-icon">🔄</div>
          <span class="feature-tag accent">{{ i18n "home.features.cards.alive.tag" }}</span>
        </div>
        <h3 class="feature-title">{{ i18n "home.features.cards.alive.title" }}</h3>
        <p class="feature-text">{{ i18n "home.features.cards.alive.text" }}</p>
        <ul class="feature-points">
          <li>{{ i18n "home.features.cards.alive.point1" }}</li>
          <li>{{ i18n "home.features.cards.alive.point2" }}</li>
          <li>{{ i18n "home.features.cards.alive.point3" }}</li>
        </ul>
      </div>

      <div class="feature-card fx-rise">
        <div class="feature-head">
          <div class="feature-icon">💬</div>
          <span class="feature-tag support">{{ i18n "home.features.cards.support.tag" }}</span>
        </div>
        <h3 class="feature-title">{{ i18n "home.features.cards.support.title" }}</h3>
        <p class="feature-text">{{ i18n "home.features.cards.support.text" }}</p>
        <ul class="feature-points">
          <li>{{ i18n "home.features.cards.support.point1" }}</li>
          <li>{{ i18n "home.features.cards.support.point2" }}</li>
          <li>{{ i18n "home.features.cards.support.point3" }}</li>
        </ul>
      </div>
    </div>
  </div>
</section>

<!-- Featured Courses Section -->
<section class="courses-section">
  <div class="container">
  <h2 class="section-title">{{ i18n "home.courses.title" }}</h2>
  <p class="section-subtitle">{{ i18n "home.courses.subtitle" }}</p>
    
    <div class="courses-grid">
      {{ range $allCourses }}
        {{ $isLesson := or (eq .Type "lessons") (eq (lower .Section) "lessons") (eq .Params.type "lessons") }}
        {{ if not $isLesson }}
        <div class="course-card">
          <div class="course-image">
            {{ if .Params.image }}
              <img src="{{ .Params.image }}" alt="{{ .Title }}" loading="lazy">
            {{ else }}
              <div class="image-placeholder">
                <div class="placeholder-icon">📚</div>
              </div>
            {{ end }}
            
            {{ if .Params.difficulty }}
              <div class="course-level">{{ .Params.difficulty }}</div>
            {{ end }}
          </div>
          
          <div class="course-content">
            <h3 class="course-title">
              <a href="{{ .Permalink }}">{{ .Title }}</a>
            </h3>
            
            {{ if .Params.description }}
              <p class="course-description">{{ .Params.description }}</p>
            {{ else }}
              <p class="course-description">{{ .Summary | truncate 120 }}</p>
            {{ end }}
          </div>
          
          <div class="course-footer">
            <a href="{{ .Permalink }}" class="course-btn">
              <span class="btn-text">{{ i18n "home.courses.view_course" }}</span>
              <svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 18l6-6-6-6"/>
              </svg>
            </a>
          </div>
        </div>
        {{ end }}
      {{ end }}
    </div>
    
    <div class="section-cta">
  <a href="{{ "/courses/" | relLangURL }}" class="btn btn-primary">{{ i18n "home.courses.view_all" }}</a>
    </div>
  </div>
</section>

<!-- Blog Section -->
<section class="blog-section">
  <div class="container">
  <h2 class="section-title">{{ i18n "home.blog.title" }}</h2>
    <div class="blog-grid">
      {{ range where .Site.RegularPages "Type" "posts" | first 3 }}
        <article class="blog-card">
          <div class="blog-image">
            {{ if .Params.image }}
              <img src="{{ .Params.image }}" alt="{{ .Title }}" loading="lazy">
            {{ end }}
          </div>
          
          <div class="blog-content">
            <h3 class="blog-title">
              <a href="{{ .Permalink }}">{{ .Title }}</a>
            </h3>
            
            <p class="blog-excerpt">{{ .Summary | truncate 100 }}</p>
            
            <div class="blog-meta">
              <time datetime="{{ .Date.Format "2006-01-02" }}" data-date="{{ .Date.Format "2006-01-02" }}">
                {{ .Date.Format "2 January 2006" }}
              </time>
            </div>
            
            <a href="{{ .Permalink }}" class="read-more">{{ i18n "home.blog.read_more" }}</a>
          </div>
        </article>
      {{ end }}
    </div>
  </div>
</section>
{{ end }}